**Code Smell : Middle Man**

1. Middle Man คืออะไร

   จากที่ผมศึกษามา Middle Man คือ "คนกลางที่ไม่มีประโยชน์" ครับ มันเกิดขึ้นเมื่อเรามี Class หนึ่งที่สร้างขึ้นมา แต่แทบไม่มี Logic หรือการทำงานเป็นของตัวเองเลย หน้าที่หลักอย่างเดียวของมันคือการรับคำสั่งจากภายนอก แล้วส่งต่อ (Delegate) ไปให้ Class อื่นทำงานแทนทั้งหมด
เหมือนเราสั่งอาหารผ่านแอปฯ แต่แอปฯ นั้นไม่ได้ช่วยตรวจสอบออเดอร์ ไม่ได้ช่วยจ่ายเงิน แค่รับคำพูดเราไปบอกร้านค้าเฉยๆ ซึ่งถ้ามันเป็นแบบนั้น เราโทรสั่งร้านค้าตรงๆ เลยจะง่ายกว่า การมี Middle Man จึงทำให้โค้ดซับซ้อนขึ้นโดยไม่จําเป็นครับ

2. ตัวอย่างโค้ดเกิดปัญหา Code Smell (Middle Man)
   
   สมมติผมเขียนระบบจัดการบริษัท โดยมี Manager คอยรับคำสั่งจากผู้บริหารเพื่อไปบอกพนักงาน (Developer) ครับ
   
```swift
class Developer {
    func writeCode() {
        print("Writing clean code...")
    }
}

class Manager {
    private let developer = Developer()

    // นี่คือ Middle Man: รับงานมาแล้วส่งต่อดื้อๆ
    // ไม่ได้ทำอะไรเลยนอกจากเรียกเมธอดของคลาสอื่น
    func delegateWork() {
        developer.writeCode()
    }
}

// การเรียกใช้งาน (Client)
let manager = Manager()
manager.delegateWork()
```
ถ้าเรามีงานอีก 10 อย่าง (เช่น FixBug, Deploy) เราก็ต้องมานั่งเขียน Method ส่งต่อใน Manager ทั้ง 10 อัน ทั้งที่มันไม่ได้ทำอะไรเพิ่มเลย

3.ตัวอย่างโค้ดที่ refactoring แล้ว (Remove Middle Man)

  วิธีแก้คือการตัด "คนกลาง" ออก และอนุญาตให้ Client เข้าถึง Object ที่ทำงานจริงได้โดยตรง เพื่อลดจำนวนโค้ดที่ต้องดูแลรักษา

```swift
class Manager {
    // เปลี่ยนจากซ่อนไว้ เป็นการเปิดให้เข้าถึงได้ (หรือส่งตัว Developer ออกไป)
    let developer = Developer()
}

// การเรียกใช้งานแบบใหม่
let manager = Manager()
manager.developer.writeCode() // คุยกับ Developer ตรงๆ ผ่าน Manager
```

เราลบ Method delegateWork ทิ้งไปได้เลย โค้ดใน Manager จะสั้นลง และถ้า Developer มีความสามารถใหม่ๆ เราก็เรียกใช้ได้ทันทีโดยไม่ต้องแก้โค้ดใน Manager อีก

4.กรณีที่ code smell นี้ไม่ได้บ่งบอกถึงโค้ดที่มีปัญหา (กรณีที่ไม่จำเป็นต้องแก้เมื่อคนกลางยังมีประโยชน์)

   ไม่ใช่ว่าเจอคนกลางแล้วต้องลบทิ้งเสมอไปครับ มีบางกรณีที่เราควรเก็บไว้:
Law of Demeter (การซ่อนความลับ): ถ้าเราไม่อยากให้คนภายนอกรู้เลยว่าข้างใน Manager มี Developer ทำงานอยู่ (เพื่อความปลอดภัยหรือความเป็นส่วนตัวของข้อมูล) การมีคนกลางคอยคัดกรองข้อมูลก่อนส่งต่อก็ถือว่ามีประโยชน์
Design Patterns: เช่น Proxy หรือ Facade ที่จงใจสร้างขึ้นมาเพื่อเป็นหน้าด่านคัดกรองงานที่ซับซ้อน แบบนี้ถือเป็น Middle Man ที่ดีครับ

**สรุป**
เราจะกำจัด Middle Man เมื่อมันกลายเป็น "ทางผ่านที่ไร้ประโยชน์" แต่จะเก็บไว้หากมันทำหน้าที่เป็น "เกราะป้องกันความซับซ้อน" ให้กับระบบ


   
